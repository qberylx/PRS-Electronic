@model IEnumerable<PurchaseWeb_2.ModelData.PR_Mst>

<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">PR List</h3>

        <div class="card-tools">
            <div class="input-group input-group-sm" style="width: 150px;">
                <input type="text" name="search" id="search" class="form-control float-right" placeholder="Search">

                <div class="input-group-append">
                    <button type="submit" class="btn btn-default">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body  p-0">
        <div class="row">
            <div class="col-md-12">
                <table class="table table-head-fixed text-nowrap table-striped table-responsive table-sm" id="tableA">
                    <tr>
                        <th>
                            PR No
                        </th>
                        <th>
                            Requestor
                        </th>
                        <th>
                            Department
                        </th>
                        <th>
                            Requisition Date
                        </th>
                        <th>
                            PR Type
                        </th>
                        <th>
                            PR Group
                        </th>
                        <th>
                            PR Status
                        </th>
                        <th>
                            Items
                        </th>

                        <th></th>
                    </tr>

                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(modelItem => item.PRNo)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Usr_mst.Username)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.AccTypeDept.DeptName)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.RequestDate)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.PRType_mst.Name)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.PrGroupType1.GroupName)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Status_Mst.Name)
                            </td>
                            <td>
                                @Html.DisplayFor(modelitem => item.PR_Details.Count)
                            </td>

                            @if (item.StatId != 1 && item.StatId != 2 && item.StatId != 13)
                            {
                                <td>
                                    @Html.ActionLink("View", "DashboardPrView", "Purchase", new { PrMstId = item.PRId }, new { @class = "btn btn-info" })
                                    @Html.ActionLink("Export To Excel", "ExportPRtoExcel", "Purchase", new { PrMstId = item.PRId }, new { @class = "btn btn-warning" })
                                    @if (item.StatId == 9)
                                    {
                                        @Html.ActionLink("Send Back PR to Sourcing", "SendToSourcing", "Purchase", new { PrMstId = item.PRId }
                                           , new { @class = "btn btn-primary", onclick = "return confirm('Are you sure you wish to send this PR back to Sourcing?');" }
                                           )
                                    }
                                    @Html.ActionLink("Audit Log", "PRAuditLog", "Purchase", new { PrMstId = item.PRId }, new { @class = "btn btn-secondary" })
                                </td>
                            }
                            else
                            {
                                <td>

                                    @Html.ActionLink("View", "DashboardPrView", "Purchase", new { PrMstId = item.PRId }, new { @class = "btn btn-info" })
                                    @Html.ActionLink("Export To Excel", "ExportPRtoExcel", "Purchase", new { PrMstId = item.PRId }, new { @class = "btn btn-warning" })

                                </td>
                            }

                        </tr>


                    }

                </table>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(function () {
        var $rows = $('#tableA tr');
        $('#search').keyup(function () {
            var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();

            $rows.show().filter(function () {
                var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
                return !~text.indexOf(val);
            }).hide();
        });
    });

    //$("#btnSend").click(function (event) {
    //    console.log("btnSend Function");
    //    var delhref = $(this).attr('href');
    //    var isOk = false;
    //    event.preventDefault();
    //    $("#confirmMsg").text("Are you sure you wish to send to Sourcing?");
    //    $('#sampleModel').modal({
    //        backdrop: 'static',
    //        keyboard: false
    //    });

    //    $("#sampleModel").off("click").on("click", "#btnOk", function (e) {
    //        e.preventDefault();
    //        $('#sampleModel').modal("hide");
    //        $('#sampleModel').data("modal", null);
    //        isOk = true;
    //    });

    //    $("#btnCancel").off("click").on("click", function (e) {
    //        e.preventDefault();
    //        $("#sampleModel").modal("hide");
    //        $("#sampleModel").data("modal", null);
    //        isOk = false;
    //    });

    //    $("#btnClose").off("click").on("click", function (e) {
    //        e.preventDefault();
    //        $("#sampleModel").modal("hide");
    //        $('#sampleModel').data("modal", null);
    //        isOk = false;
    //    });

    //    $("#sampleModel").off("hidden.bs.modal").on("hidden.bs.modal", function (e) {
    //        e.preventDefault();
    //        if (isOk) {
    //            //here you require some customization in URl, change according to your requirement
    //            window.location.href = window.location.href + delhref;
    //        }
    //    })
    //    return isOk;
    //});

    //function confirmDialog() {
    //    var url = $(this).attr('href');
    //    $("#dialog-confirm").dialog({
    //        autoOpen: false,
    //        resizable: false,
    //        height: 170,
    //        width: 350,
    //        show: { effect: 'drop', direction: "up" },
    //        modal: true,
    //        draggable: true,
    //        buttons: {
    //            "OK": function () {
    //                $(this).dialog("close");
    //                window.location = url;
    //            }, "Cancel": function () {
    //                $(this).dialog("close");
    //            }
    //        }
    //    });
    //    $("#dialog-confirm").dialog('open');
    //    return false;
    //}

    //$(document).ready(function () {
    //    $(".confirmDialog").on("click", function (e) {
    //        // e.preventDefault(); use this or return false
    //        var url = $(this).attr('href');
    //        $("#dialog-confirm").dialog({
    //            autoOpen: false,
    //            resizable: false,
    //            height: 170,
    //            width: 350,
    //            show: { effect: 'drop', direction: "up" },
    //            modal: true,
    //            draggable: true,
    //            buttons: {
    //                "OK": function () {
    //                    $(this).dialog("close");
    //                    window.location = url;
    //                }, "Cancel": function () {
    //                    $(this).dialog("close");
    //                }
    //            }
    //        });
    //        $("#dialog-confirm").dialog('open');
    //        return false;
    //    });
    //});

</script>

