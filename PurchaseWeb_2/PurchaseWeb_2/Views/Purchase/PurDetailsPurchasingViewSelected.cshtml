@model IEnumerable<PurchaseWeb_2.ModelData.PR_Details>

<div class="card card-success">
    <div class="card-header">
        <h3 class="card-title">Purchase Request Details List</h3>

        <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                <i class="fas fa-minus"></i>
            </button>
        </div>
    </div>
    <div class="card-body  p-0">

        <div class="row">
            <div class="col-md-12">
                <table class="table table-head-fixed text-nowrap table-striped table-responsive table-sm">
                    @if (ViewBag.PrTypeId == 3 || ViewBag.PrTypeId == 5)
                    {
                        <tr>
                            <th>
                                No.
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Description)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.DomiPartNo)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.VendorName)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Qty)
                            </th>
                            <th>
                                UOM
                            </th>
                            <th>
                                Req. Delivery Date
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Remarks)
                            </th>
                            <th>
                                Currency
                            </th>
                            <th>
                                Unit Price
                            </th>
                            <th>
                                Total Amount <br /> (Exc Tax)
                            </th>
                            <th>
                                Tax %
                            </th>
                            <th>
                                Total Amount <br /> (Inc Tax)
                            </th>
                            <th>
                                Tax Group
                            </th>
                            <th>
                                Tax Class
                            </th>

                            <th style="display:none"></th>
                        </tr>
                    }
                    else if (ViewBag.PrTypeId == 4)
                    {
                        <tr>
                            <th>
                                No.
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Description)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.VendorPartNo)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Qty)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.UOM_mst.UOMName)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.ReqDevDate)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Currency_Mst.Kod)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.EstimateUnitPrice)
                            </th>
                            <th>
                                Actual <br />Unit Price
                            </th>
                            <th>
                                Total Cost (Exc.)
                            </th>
                            <th>
                                Tax %
                            </th>
                            <th>
                                Total Cost (Icl.)
                            </th>
                            <th>
                                Tax Group
                            </th>
                            <th>
                                Tax Class
                            </th>

                            <th style="display:none"></th>
                        </tr>
                    }
                    else
                    {
                        <tr>
                            <th>
                                No.
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.DomiPartNo)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.VendorPartNo)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Qty)
                            </th>
                            <th>
                                Request <br /> Delivery Date
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Remarks)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Device)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.SalesOrder)
                            </th>
                            <th>
                                Currency
                            </th>
                            <th>
                                Unit Price
                            </th>
                            <th>
                                Tax %
                            </th>
                            <th>
                                Total Amount <br /> (Inc Tax)
                            </th>
                            <th>
                                Tax Group
                            </th>
                            <th>
                                Tax Class
                            </th>
                            

                            <th style="display:none"></th>
                        </tr>
                    }


                    @{ int i = 0;}
                    @if (ViewBag.PrTypeId == 3 || ViewBag.PrTypeId == 5)
                    {
                        foreach (var item in Model)
                        {
                            i++;
                            <tr>
                                <td>
                                    @i
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Description)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.DomiPartNo)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VendorName)
                                </td>
                                <td>
                                    @{String strQty = String.Format("{0:n}", item.Qty);}
                                    @strQty
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.UOMName)
                                </td>
                                <td>
                                    @{DateTime reqdate = (DateTime)item.ReqDevDate;
                                        String strReqdate = reqdate.ToString("dd/MM/yyyy");}
                                    @strReqdate
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Remarks)
                                </td>
                                <th>
                                    @Html.DisplayFor(modelItem => item.CurCode)
                                </th>
                                <th>
                                    @{String strUnitPrice = String.Format("{0:n}", item.UnitPrice);}
                                    @strUnitPrice
                                </th>
                                <th>
                                    @{String strTotCostnoTax = String.Format("{0:n}", item.TotCostnoTax);}
                                    @strTotCostnoTax
                                    
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.Tax)
                                </th>
                                <th>
                                    @{String strTotCostWitTax = String.Format("{0:n}", item.TotCostWitTax);}
                                    @strTotCostWitTax
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.TaxCode)
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.TaxClass)
                                </th>
                                <td style="display:none">
                                    @using (Ajax.BeginForm("DelPurList", "Purchase", new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "divPurDtlsList" }))
                                    {
                                        <input type="hidden" id="PrDtlsId" name="PrDtlsId" value="@item.PRDtId" />
                                        <input type="hidden" id="DelPrMstId" name="DelPrMstId" value="@item.PRid" />
                                        <button class="btn btn-danger"><i class="fa fa-trash fa-xs"></i></button>
                                    }

                                </td>
                            </tr>
                        }
                    }
                    else if (ViewBag.PrTypeId == 4)
                    {
                        foreach (var item in Model)
                        {
                            i++;
                            <tr>
                                <td>
                                    @i
                                </td>
                                <td>
                                    @Html.Raw(item.Description.Replace(Environment.NewLine, "<br/>"))
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VendorPartNo)
                                </td>
                                <td>
                                    @{String strQty = String.Format("{0:n}", item.Qty);}
                                    @strQty
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.UOMName)
                                </td>
                                <td>
                                    @{DateTime reqdate = (DateTime)item.ReqDevDate;
                                        String strReqdate = reqdate.ToString("dd/MM/yyyy");}
                                    @strReqdate
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.CurCode)
                                </td>
                                <td>
                                    @{String strEstimateUnitPrice = String.Format("{0:n}", item.EstimateUnitPrice);}
                                    @strEstimateUnitPrice
                                    
                                </td>
                                <th>
                                    @{String strUnitPrice = String.Format("{0:n}", item.UnitPrice);}
                                    @strUnitPrice
                                </th>
                                <th>
                                    @{String strTotCostnoTax = String.Format("{0:n}", item.TotCostnoTax);}
                                    @strTotCostnoTax
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.Tax)
                                </th>
                                <th>
                                    @{String strTotCostWitTax = String.Format("{0:n}", item.TotCostWitTax);}
                                    @strTotCostWitTax
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.TaxCode)
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.TaxClass)
                                </th>
                                <td style="display:none">
                                    @using (Ajax.BeginForm("DelPurList", "Purchase", new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "divPurDtlsList" }))
                                    {
                                        <input type="hidden" id="PrDtlsId" name="PrDtlsId" value="@item.PRDtId" />
                                        <input type="hidden" id="DelPrMstId" name="DelPrMstId" value="@item.PRid" />
                                        <button class="btn btn-danger"><i class="fa fa-trash fa-xs"></i></button>
                                    }

                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        foreach (var item in Model)
                        {
                            i++;
                            <tr>
                                <td>
                                    @i
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.DomiPartNo)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VendorPartNo)
                                </td>
                                <td>
                                    @{String strQty = String.Format("{0:n}", item.Qty);}
                                    @strQty
                                </td>
                                <td>
                                    @{DateTime reqdate = (DateTime)item.ReqDevDate;
                                        String strReqdate = reqdate.ToString("dd/MM/yyyy");}
                                    @strReqdate
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Remarks)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Device)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.SalesOrder)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.CurCode)
                                    @{ViewBag.Currency = item.CurCode;}
                                </td>
                                <th>
                                    @{String strUnitPrice = String.Format("{0:n}", item.UnitPrice);}
                                    @strUnitPrice
                                    
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.Tax)
                                </th>
                                <th>
                                    <!--col 12-->
                                    @{String strTotCostWitTax = String.Format("{0:n}", item.TotCostWitTax);}
                                    @strTotCostWitTax
                                    
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.TaxCode)
                                </th>
                                <th>
                                    @Html.DisplayFor(modelItem => item.TaxClass)
                                </th>


                                <td style="display:none">
                                    @using (Ajax.BeginForm("DelPurList", "Purchase", new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "divPurDtlsList" }))
                                    {
                                        <input type="hidden" id="PrDtlsId" name="PrDtlsId" value="@item.PRDtId" />
                                        <input type="hidden" id="DelPrMstId" name="DelPrMstId" value="@item.PRid" />
                                        <button class="btn btn-danger"><i class="fa fa-trash fa-xs"></i></button>
                                    }

                                </td>
                            </tr>
                        }
                    }

                <tr>
                    @if (ViewBag.PrTypeId == 3 || ViewBag.PrTypeId == 5)
                    {
                        <td colspan="10"></td>
                    }
                    else 
                    { 
                        <td colspan="9"></td>
                    }                    
                    <th>Grand Total</th>
                    <td></td>
                    <th>
                        <div class="row">
                            <div class="col-md-4">
                                @foreach (var item in Model.OrderBy(o => o.CurCode).GroupBy(x => x.CurCode))
                                {
                                    @item.Max(s => s.CurCode) <br />
                                }
                            </div>
                            <div class="col-md-8">
                                @foreach (var item in Model.OrderBy(o => o.CurCode).GroupBy(x => x.CurCode))
                                {
                                    String strTotCostWitTax = String.Format("{0:n}", item.Sum(s => s.TotCostWitTax));
                                    @strTotCostWitTax
                                    @*item.Sum(s => s.TotCostWitTax) *@
                                    <br />
                                }
                            </div>
                        </div>
                        
                        
                        @*ViewBag.Currency @ViewBag.GrandTotal*@
                    </th>
                    <td colspan="2"></td>
                </tr>

                </table>
            </div>
        </div>
    </div>
    <!-- /.card-body -->
</div>
